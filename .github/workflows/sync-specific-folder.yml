name: sync-specific-folder
run-name: ${{ github.actor }} is running sync folder
on:
  pull_request_target:
    branches:
      - main
    types:
      - closed
  push:
    branches:
      - main
permissions:
  contents: write
jobs:
  sync-branch:
    # if: github.event.pull_request.merged == true && contains(github.event.pull_request.labels.*.name, 'sync-branch')
    runs-on: ubuntu-latest
    environment:
      name: production
    steps:
      - name: Checkout node
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: sync site branch with change of merge commit
        continue-on-error: true
        run: |
            git branch
            # commit_hash=${{ github.event.pull_request.base.sha }}
            commit_hash=dc40a099a7e98bdd2791ab583f912143332f34e6
            IFS="," read -r -a branches <<< ${{ vars.SITE_BRANCHES }}

            # Loop through the array elements
            for branch in "${branches[@]}"
            do
                echo "============================="
                echo "Start sync branch: $branch"
                git checkout "$branch"
                set +e
                git cherry-pick -m 1 "$commit_hash" >/dev/null
                set -e
                cherry_pick_status=$?
                echo "$cherry_pick_status"
                # Handle the cherry pick result
                if [ $cherry_pick_status -eq 0 ]; then
                  git push origin $branch
                  echo "Cherry pick successful on $branch"
                else
                  git cherry-pick --abort
                  echo "Cherry pick failed on $branch"
                fi
            done
